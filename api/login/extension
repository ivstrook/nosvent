const express = require('express');
const bodyParser = require('body-parser');
const cors = require('cors');
const app = express();
const PORT = process.env.PORT || 5000;

app.use(cors());
app.use(bodyParser.json());

// /api/login/extensionエンドポイント
app.post('/api/login/extension', (req, res) => {
    const { pubkey, sig } = req.body;

    // 入力の検証
    if (!pubkey || !sig) {
        return res.status(400).json({ error: 'pubkey and signature are required' });
    }

    // ここでpubkeyやsigの検証処理を行う（例：データベースとの照合など）
    // ここでは仮の処理を行います
    const isValid = validateSignature(pubkey, sig); // 署名検証の関数を呼び出し

    if (!isValid) {
        return res.status(401).json({ error: 'Invalid signature' });
    }

    // ログイン成功時のユーザー情報を返す
    const user = { pubkey, username: 'exampleUser' }; // 仮のユーザー情報
    return res.status(200).json({ message: 'Login successful', user });
});

// 署名検証のための仮の関数
function validateSignature(pubkey, sig) {
    // 実際には署名の検証ロジックを実装してください
    return true; // 仮の処理
}

app.listen(PORT, () => {
    console.log(`Server is running on port ${PORT}`);
});
